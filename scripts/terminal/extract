#!/usr/bin/env bash
set -e
for filename in "$@"; do
    target="${filename%.*}"

    if [ -d "${target}" ]; then
        echo Error: directory exists \"${target}\"
        exit 1
    fi
done

for filename in "$@"; do
    target="${filename%.*}"
    tarext=".tar."
    if test "${filename#*$tarext}" != "$filename"; then
        target="${target%.*}"
        7z x "${filename}" -so | 7z x -aoa -si -ttar -o"${target}"
    else
        7z x -spe -o"${target}" "${filename}"
    fi
done
