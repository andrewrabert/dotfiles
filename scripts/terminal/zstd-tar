#!/usr/bin/env sh
set -eu
SOURCE="$(realpath "$1")"
DEST="${SOURCE}.tar.zst"

if [ -f "$SOURCE" ]; then
    tar cf - -C "$(dirname "$SOURCE")" "$(basename "$SOURCE")" | zstd -T0 --ultra -22 -o "$DEST"
elif [ -d "$SOURCE" ]; then
    find "$SOURCE" -printf "%P\n" | tar cf - -C "$SOURCE" -T - | zstd -T0 --ultra -22 -o "$DEST"
fi
