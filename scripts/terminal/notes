#!/usr/bin/env sh
set -e

NOTES_DIR="${NOTES_DIR:-$HOME/Notes}"
if ! [ -d "$NOTES_DIR" ]; then
    echo error: notes directory does not exist: \""$NOTES_DIR"\" >&2
    exit 1
fi
cd "${NOTES_DIR}"

editor() {
    exec "${EDITOR}" -c AutoSaveToggle "$@"
}

while true; do
    case "$1" in
        --)
            shift
            exec "$@"
            ;;
        *)
            if [ -n "$1" ]; then
                mkdir -p "$(dirname "$1")"
                editor -- "$1"
            else
                editor -- scratch.md
            fi
            break
    esac
done
