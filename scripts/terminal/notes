#!/usr/bin/env sh
set -e

NOTES_DIR="${NOTES_DIR:-$HOME/Notes}"
if ! [ -d "$NOTES_DIR" ]; then
    echo error: notes directory does not exist: \""$NOTES_DIR"\" >&2
    exit 1
fi
cd "${NOTES_DIR}"

SHOW_PATH=
while true; do
    case "$1" in
        -p)
            SHOW_PATH=1
            shift
            ;;
        -f)
            NOTE_FILE="$(fd -t f | fzf)"
            if [ -z "$NOTE_FILE" ]; then
                exit
            else
                exec notes "$NOTE_FILE"
            fi 
            ;;
        *)
            break
    esac
done

NOTE_FILE=
case $# in
    0)
        NOTE_FILE=scratch.md
        ;;
    1)
        NOTE_FILE="$1"
        mkdir -p "$(dirname -- "$NOTE_FILE")"
        ;;
    *)
        echo 'error: unknown arguments' >&2
        exit 1
        ;;
esac

if [ -n "$SHOW_PATH" ]; then
    realpath "$NOTE_FILE"
else
    exec "${EDITOR}" -- "$NOTE_FILE"
fi
