#!/usr/bin/env sh
set -e

show_help() {
    cat << EOF
usage: batch-rename [--prepend TEXT] PATH [PATH...]

    --help      show help then exit
    --append    append text to paths
    --prepend   prepend text to paths
EOF
}


PREPEND=''
APPEND=''
while true; do
    case "$1" in
        --help)
            show_help
            exit
            ;;
        --append)
            APPEND="$2"
            shift
            shift
            ;;
        --prepend)
            PREPEND="$2"
            shift
            shift
            ;;
        *)
            if [ $# -eq 0 ]; then
                show_help >&2
                echo error: no paths specified >&2
                exit 1
            fi
            break
    esac
done


append_prepend_path() {
    new_path="$(dirname "$1")/${PREPEND}$(basename "$1")${APPEND}"
    if [ -e "$new_path" ]; then
        echo error: tried moving "$1" to existing "$new_path" >&2
        exit 1
    fi
    mv "$1" "$new_path"
    echo "$new_path"
}


for f in "$@"; do
    if [ -n "$PREPEND" ]; then
        f="$(append_prepend_path "$f")"
        echo "$f"
    fi
done
