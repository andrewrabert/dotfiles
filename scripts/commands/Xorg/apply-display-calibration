#!/usr/bin/env sh
set -e

clear_existing_calibration() {
    dispwin -h 2>&1 | grep Output | awk '{print $1}' | xargs -n 1 dispwin -c -d > /dev/null 2>&1
}

show_help() {
    cat << EOF
usage: apply-display-calibration [--help] [--reset]

no args will apply display calibration automatically

    --reset     reset display calibration
    --help      show help and exit
EOF
}


while true; do
    case "$1" in
        --help)
            show_help
            exit
            ;;
        --reset)
            clear_existing_calibration
            exit
            ;;
        *)
            if [ $# -ne 0 ]; then
                show_help
                echo error: unknown arguments >&2
                exit 1
            fi
            break
    esac
done


clear_existing_calibration

case "$(hostname)" in
    "phobos")
        dispwin -d1 "$DOTFILES/icc/xps13_phobos.icc"
        ;;
    "apollo")
        dispwin -d1 "$DOTFILES/icc/surface_go.icc"
        ;;
    *)
esac
