#!/usr/bin/env sh
cd ~ || exit 1

# Update GUI environment variables for Wayland/X11 if available
# Only run on appropriate hosts (not Termux or macOS)
update_gui_env() {
    if [ -n "$WAYLAND_DISPLAY" ] || [ -n "$DISPLAY" ]; then
        tmux set-environment -g WAYLAND_DISPLAY "$WAYLAND_DISPLAY" 2>/dev/null || true
        tmux set-environment -g XDG_RUNTIME_DIR "$XDG_RUNTIME_DIR" 2>/dev/null || true
        tmux set-environment -g DISPLAY "$DISPLAY" 2>/dev/null || true

    fi
}

SESSIONS="$(tmux list-sessions 2> /dev/null | head -n 1)"
if [ -n "$SESSIONS" ]; then
    case "$SESSIONS" in
        *"(attached)")
            if [ "$1" = '--prompt' ]; then
                echo 'Press enter to attach to tmux session ...'
                head -n 1 > /dev/null
            fi
            ;;
    esac
    update_gui_env
    exec tmux a -d
else
    exec tmux
fi
