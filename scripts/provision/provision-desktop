#!/usr/bin/env bash

link_file() {
    source_path="$PWD/$1"
    target_path="$2"
    echo -e "\033[1;33mLinking $1 \033[0m"
    if ! [ -e "$source_path" ]; then
        echo error: path $source_path does not exist. >&2
        exit 1
    fi
    rm -rf "$target_path"
    ln -sf "$source_path" "$target_path"
}

zsh_command() {
    echo -e "\033[1;33mNow running $@ \033[0m..."
    zsh -c "$@"
}

osname=$(uname)
if [[ $osname == Linux* ]]; then
    link_file compton/compton.conf ~/.config/compton.conf
    link_file dunst ~/.config/dunst
    link_file fontconfig ~/.config/fontconfig
    link_file i3blocks ~/.config/i3blocks
    link_file mimeapps/mimeapps.list ~/.config/mimeapps.list
    link_file mpd-notification/mpd-notification.conf ~/.config/mpd-notification.conf
    link_file mpv ~/.config/mpv
    link_file qt5ct ~/.config/qt5ct
    link_file rofi ~/.config/rofi
    link_file xbindkeys/.xbindkeysrc ~/..xbindkeysrc
    link_file xinit/.xinitrc ~/.xinitrc
    link_file zsh/.zprofile ~/.zprofile
    link_file environment.d ~/.config/environment.d

    systemctl --user enable syncthing
elif [[ $osname == Darwin ]]; then
    zsh_command 'pip install osxmpdkeys'
    link_file karabiner ~/.config/karabiner
fi

link_file mpd ~/.config/mpd
link_file ncmpcpp ~/.config/ncmpcpp

zsh_command 'pip install base16-shell-preview'

if ! [ -e $HOME/.base16_theme ]; then
    zsh_command -i base16_default-dark
fi
