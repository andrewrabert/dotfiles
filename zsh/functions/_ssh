#compdef ssh

# Limit ssh completions to hosts only
zstyle ':completion:*:ssh:argument-1:*' tag-order hosts

# Generic function to source the parent completion in fpath
_source_parent_completion() {
    local completion_name="$1"
    local current_file="${(%):-%x}"
    local found_current=false

    for dir in "$fpath[@]"; do
        local candidate="$dir/$completion_name"
        [[ -f "$candidate" ]] || continue
        if [[ "$candidate" == "$current_file" ]]; then
            found_current=true
        elif $found_current; then
            source "$candidate"
            return
        fi
    done
    return 1
}

# Source the original _ssh completion
_source_parent_completion "_ssh"
